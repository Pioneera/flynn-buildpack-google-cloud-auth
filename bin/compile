#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir> <env-dir>

BUILD_DIR=${1:-}
CACHE_DIR=${2:-}
ENV_DIR=${3:-}

if [ -f $ENV_DIR/GOOGLE_CREDENTIALS ]
then
  google_cloud_credentials="$(cat $ENV_DIR/GOOGLE_CREDENTIALS)"
  if [ "$google_cloud_credentials" != "" ]; then
  	echo "-----> Creating $BUILD_DIR/google-credentials.json"
  	echo "$google_cloud_credentials" > "$BUILD_DIR/google-credentials.json"
    mkdir -p /app/secrets
    cp "$BUILD_DIR/google-credentials.json" "/app/secrets/"
  	exit 0
  else
    echo "-----> Unable to create Google Credentials no GOOGLE_CREDENTIALS defined"
  fi
else
  echo "-----> Unable to create Google Credentials no GOOGLE_CREDENTIALS defined"
  exit 0
fi
